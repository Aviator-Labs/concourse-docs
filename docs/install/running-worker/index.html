
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://aviator-labs.github.io/concourse-docs/docs/install/running-worker/">
      
      
        <link rel="prev" href="../running-web/">
      
      
        <link rel="next" href="../upgrading-concourse/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Running a worker node - Concourse Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-a-worker-node" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Concourse Docs" class="md-header__button md-logo" aria-label="Concourse Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Concourse Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running a worker node
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Aviator-Labs/concourse-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Aviator-Labs/concourse-docs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Concourse

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Docs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../project/" class="md-tabs__link">
        
  
  
    
  
  Project

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../ecosystem/" class="md-tabs__link">
        
  
  
    
  
  Ecosystem

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../support/" class="md-tabs__link">
        
  
  
    
  
  Support

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Concourse Docs" class="md-nav__button md-logo" aria-label="Concourse Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Concourse Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Aviator-Labs/concourse-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Aviator-Labs/concourse-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concourse
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../getting-started/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Install
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../running-postgres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running a PostgreSQL Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concourse-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The concourse CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generating-keys/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating Keys
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../running-web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running a web node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Running a worker node
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Running a worker node
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-concourse-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Running concourse worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running concourse worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resource-utilization" class="md-nav__link">
    <span class="md-ellipsis">
      Resource utilization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-a-worker-node" class="md-nav__link">
    <span class="md-ellipsis">
      Operating a worker node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operating a worker node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaling-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Workers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Workers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#horizontal-vs-vertical-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal vs Vertical Scaling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-heartbeating-stalling" class="md-nav__link">
    <span class="md-ellipsis">
      Worker Heartbeating &amp; Stalling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Restarting a Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracefully-removing-a-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Gracefully Removing a Worker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-worker-node" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the worker node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the worker node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tagging-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Tagging Workers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#team-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Team Workers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Team Workers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tags-and-team-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Tags and Team Workers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#healthcheck-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Healthcheck Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundled-resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Bundled Resource Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-or-upgrading-bundled-resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Installing or Upgrading Bundled Resource Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-runtimes" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Runtimes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring Runtimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#containerd-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      containerd runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transitioning-from-guardian-to-containerd" class="md-nav__link">
    <span class="md-ellipsis">
      Transitioning from Guardian to containerd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardian-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Guardian runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-and-fixing-dns-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting and fixing DNS resolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting and fixing DNS resolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointing-to-external-dns-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Pointing to external DNS servers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-local-dns-server" class="md-nav__link">
    <span class="md-ellipsis">
      Using a local DNS server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-note-on-allowing-host-access-and-dns-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      A note on allowing host access and DNS proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-peer-to-peer-volume-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Peer-to-Peer Volume Streaming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring Peer-to-Peer Volume Streaming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p2p-worker-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      P2P Worker Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2p-web-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      P2P Web Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading-concourse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrading Concourse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../auth-and-teams/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Auth & Teams
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The fly CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config-basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Config Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../pipelines/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Pipelines
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../vars/index.md" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Vars
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../resources/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../resource-types/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Resource Types
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../steps/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Steps
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../builds/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Builds
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../how-to/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../operation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Operation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../observation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Observation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../internals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Internals
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../examples/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecosystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ecosystem
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../blog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-concourse-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Running concourse worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running concourse worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resource-utilization" class="md-nav__link">
    <span class="md-ellipsis">
      Resource utilization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-a-worker-node" class="md-nav__link">
    <span class="md-ellipsis">
      Operating a worker node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operating a worker node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaling-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Workers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Workers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#horizontal-vs-vertical-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal vs Vertical Scaling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-heartbeating-stalling" class="md-nav__link">
    <span class="md-ellipsis">
      Worker Heartbeating &amp; Stalling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Restarting a Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracefully-removing-a-worker" class="md-nav__link">
    <span class="md-ellipsis">
      Gracefully Removing a Worker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-worker-node" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the worker node
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the worker node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tagging-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Tagging Workers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#team-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Team Workers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Team Workers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tags-and-team-workers" class="md-nav__link">
    <span class="md-ellipsis">
      Tags and Team Workers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#healthcheck-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Healthcheck Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundled-resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Bundled Resource Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-or-upgrading-bundled-resource-types" class="md-nav__link">
    <span class="md-ellipsis">
      Installing or Upgrading Bundled Resource Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-runtimes" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Runtimes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring Runtimes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#containerd-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      containerd runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transitioning-from-guardian-to-containerd" class="md-nav__link">
    <span class="md-ellipsis">
      Transitioning from Guardian to containerd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardian-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Guardian runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-and-fixing-dns-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting and fixing DNS resolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting and fixing DNS resolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointing-to-external-dns-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Pointing to external DNS servers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-local-dns-server" class="md-nav__link">
    <span class="md-ellipsis">
      Using a local DNS server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-note-on-allowing-host-access-and-dns-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      A note on allowing host access and DNS proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-peer-to-peer-volume-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Peer-to-Peer Volume Streaming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring Peer-to-Peer Volume Streaming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p2p-worker-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      P2P Worker Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2p-web-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      P2P Web Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="running-a-worker-node">Running a <code>worker</code> node</h1>
<p>The <code>worker</code> node registers with the <a href="../running-web/"><code>web</code> node</a> and is then used for executing builds and performing
resource <code>check</code>s. It doesn't really decide much on its own.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Linux:<ul>
<li>We test and support the following distributions. Minimum kernel version tested is 5.15.<ul>
<li>Ubuntu 22.04</li>
<li>Ubuntu 24.04</li>
</ul>
</li>
<li>Other Requirements:<ul>
<li>User namespaces must be enabled.</li>
<li>To enforce memory limits on tasks, memory + swap accounting must be enabled.</li>
</ul>
</li>
</ul>
</li>
<li>Windows/Darwin:<ul>
<li>no special requirements (that we know of).</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Windows containers are currently not supported and Darwin does not have native containers. Steps will run inside 
a temporary directory on the Windows/Darwin worker. Any dependencies needed for your tasks (e.g. git, .NET, golang, 
ssh) should be pre-installed on the worker. Windows/Darwin workers do not come with any resource types.</p>
</div>
<h2 id="running-concourse-worker">Running <code>concourse worker</code></h2>
<p>The <code>concourse</code> CLI can run as a <code>worker</code> node via the <code>worker</code> subcommand.</p>
<p>First, you'll need to configure a directory for the worker to store data:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nv">CONCOURSE_WORK_DIR</span><span class="o">=</span>/opt/concourse/worker
</span></code></pre></div>
<p>This is where all the builds run, and where all resources are fetched in to, so make sure it's backed by enough storage.</p>
<p>Next, point the worker at your <a href="../running-web/"><code>web</code> node</a> like so:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nv">CONCOURSE_TSA_HOST</span><span class="o">=</span><span class="m">10</span>.0.2.15:2222
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nv">CONCOURSE_TSA_PUBLIC_KEY</span><span class="o">=</span>path/to/tsa_host_key.pub
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nv">CONCOURSE_TSA_WORKER_PRIVATE_KEY</span><span class="o">=</span>path/to/worker_key
</span></code></pre></div>
<p>Finally start the worker:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># run with -E to forward env config, or just set it all as root</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>sudo<span class="w"> </span>-E<span class="w"> </span>concourse<span class="w"> </span>worker
</span></code></pre></div>
<p>Note that the worker must be run as <code>root</code> because it orchestrates containers.</p>
<p>All logs will be emitted to <code>stdout</code>, with any panics or lower-level errors being emitted to <code>stderr</code>.</p>
<h3 id="resource-utilization">Resource utilization</h3>
<p><strong>CPU usage</strong>: almost entirely subject to pipeline workloads. More resources configured will result in more checking,
and in-flight builds will use as much CPU as they want.</p>
<p><strong>Memory usage</strong>: also subject to pipeline workloads. Expect usage to increase with the number of containers on the
worker and spike as builds run.</p>
<p><strong>Bandwidth usage</strong>: again, almost entirely subject to pipeline workloads. Expect spikes from periodic checking, though
the intervals should spread out over enough time. Resource fetching and pushing will also use arbitrary bandwidth.</p>
<p><strong>Disk usage</strong>: arbitrary data will be written as builds run, and resource caches will be kept and garbage collected on
their own life cycle. We suggest going for a larger disk size if it's not too much trouble. All state on disk must not
outlive the worker itself; it is all ephemeral. If the worker is re-created (i.e. fresh VM/container and all processes
were killed), it should be brought back with an empty disk.</p>
<p><strong>Highly available</strong>: not applicable. Workers are inherently singletons, as they're being used as drivers running
entirely different workloads.</p>
<p><strong>Horizontally scalable</strong>: yes; workers directly correlate to your capacity required by however many pipelines,
resources, and in-flight builds you want to run. It makes sense to scale them up and down with demand.</p>
<p><strong>Outbound traffic</strong>:</p>
<ul>
<li>External traffic to arbitrary locations as a result of periodic resource checking and running builds</li>
<li>External traffic to the <code>web</code> node's configured external URL when downloading the inputs for a <a href="https://concourse-ci.org/tasks.html#running-tasks">
  <code>fly execute</code></a></li>
<li>External traffic to the <code>web</code> node's TSA port (<code>2222</code>) for registering the worker</li>
<li>If P2P streaming is enabled there will be traffic to other workers.</li>
</ul>
<p><strong>Inbound traffic</strong>:</p>
<ul>
<li>From the <a href="../running-web/"><code>web</code> node</a> on port <code>7777</code> (Garden) and <code>7788</code> (BaggageClaim). These ports do not need to be
  exposed, they are forwarded to the web node via the ssh connection on port <code>2222</code>.</li>
<li>If P2P streaming is enabled there will be traffic to other workers.</li>
</ul>
<h2 id="operating-a-worker-node">Operating a <code>worker</code> node</h2>
<p>The <code>worker</code> nodes are designed to be stateless and as interchangeable as
possible. <a href="https://concourse-ci.org/tasks.html">Tasks</a> and <a href="https://concourse-ci.org/resources.html">Resources</a> bring
their own Docker images, so you should never have to install dependencies on the worker. Windows and Darwin workers are
the exception to this. Any dependencies should be pre-installed on Windows and Darwin workers.</p>
<p>In Concourse, all important data is represented by <a href="https://concourse-ci.org/resources.html">Resources</a>, so the workers
themselves are dispensable. Any data in the work-dir is ephemeral and should go away when the worker machine is
removed - it should not be persisted between worker VM or container re-creates.</p>
<h3 id="scaling-workers">Scaling Workers</h3>
<p>More workers should be added to accommodate more pipelines. To know when this is necessary you should probably set
up <a href="https://concourse-ci.org/metrics.html">Metrics</a> and keep an eye on container counts. If average container count
starts to approach 200 or so per worker, you should probably add another worker. Load average is another metric to keep
an eye on.</p>
<p>To add a worker, just create another machine for the worker and follow the <a href="./#running-a-worker-node">Running
<code>concourse worker</code></a> instructions again.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It doesn't make sense to run multiple workers on one machine since they'll both be contending for the same 
physical resources. Workers should be given their own VMs or physical machines to maximize resource usage.</p>
</div>
<h4 id="horizontal-vs-vertical-scaling">Horizontal vs Vertical Scaling</h4>
<p>The answer to whether you should scale your workers horizontally or vertically depends heavily on what workloads your
pipelines are running. Anecdotally though, we have seen that a lot of smaller workers (horizontal scaling) is usually
better than a few large workers (vertical scaling).</p>
<p>Again, this is not an absolute answer! You will have to test this out against the workloads your pipelines demand and
adjust based on the <a href="https://concourse-ci.org/metrics.html">Metrics</a> that you are tracking.</p>
<h3 id="worker-heartbeating-stalling">Worker Heartbeating &amp; Stalling</h3>
<p>Workers will continuously heartbeat to the Concourse cluster in order to remain registered and healthy. If a worker
hasn't checked in after a while, possibly due to a network error, being overloaded, or having crashed, the web node will
transition its state to <code>stalled</code> and new workloads will not be scheduled on that worker until it recovers.</p>
<p>If the worker remains in this state and cannot be recovered, it can be removed using the <a href="https://concourse-ci.org/administration.html#fly-prune-worker">
<code>fly prune-worker</code></a> command.</p>
<h3 id="restarting-a-worker">Restarting a Worker</h3>
<p>Workers can be restarted in-place by sending <code>SIGTERM</code> to the worker process and starting it back up. Containers will
remain running and Concourse will reattach to builds that were in flight.</p>
<p>This is a pretty aggressive way to restart a worker, and may result in errored builds - there are a few moving parts
involved and we're still working on making this airtight.</p>
<p>A safer way to restart a worker is to land it by sending <code>SIGUSR1</code> to the <code>worker</code> process. This will switch the worker
to the <code>landing</code> state and Concourse will stop scheduling new work on it. When all builds running on the worker have
finished, the process will exit.</p>
<p>You may want to enforce a timeout for draining - that way a stuck build won't prevent your workers from being upgraded.
This can be enforced by common tools like <code>start-stop-daemon</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>start-stop-daemon<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span>--pidfile<span class="w"> </span>worker.pid<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span>--stop<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span>--retry<span class="w"> </span>USR1/300/TERM/15/KILL
</span></code></pre></div>
<p>This will send <code>SIGUSR1</code>, wait up to 5 minutes, and then send <code>SIGTERM</code>. If it's <em>still</em> running, it will be killed
after an additional 15 seconds.</p>
<p>Once the timeout is enforced, there's still a chance that builds that were running will continue when the worker comes
back.</p>
<h3 id="gracefully-removing-a-worker">Gracefully Removing a Worker</h3>
<p>When a worker machine is going away, it should be <em>retired</em>. This is similar to <em>landing</em>, except at the end the worker
is completely unregistered, along with its volumes and containers. This should be done when a worker's VM or container
is being destroyed.</p>
<p>To retire a worker, send <code>SIGUSR2</code> to the <code>worker</code> process. This will switch the worker to <code>retiring</code> state, and
Concourse will stop scheduling new work on it. When all builds running on the worker have finished, the worker will be
removed and the <code>worker</code> process will exit.</p>
<p>Just like with landing, you may want to enforce a timeout for draining - that way a stuck build won't prevent your
workers from being upgraded. This can be enforced by common tools like <code>start-stop-daemon</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>start-stop-daemon<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span>--pidfile<span class="w"> </span>worker.pid<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span>--stop<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span>--retry<span class="w"> </span>USR2/300/TERM/15/KILL
</span></code></pre></div>
<p>This will send <code>SIGUSR2</code>, wait up to 5 minutes, and then send <code>SIGTERM</code>. If it's <em>still</em> running, it will be killed
after an additional 15 seconds.</p>
<h2 id="configuring-the-worker-node">Configuring the <code>worker</code> node</h2>
<h3 id="tagging-workers">Tagging Workers</h3>
<p>If there's something special about your worker and you'd like to target builds at it specifically, you can configure
tags like so:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nv">CONCOURSE_TAG</span><span class="o">=</span><span class="s2">&quot;tag-1,tag-2&quot;</span>
</span></code></pre></div>
<p>A tagged worker is taken out of the default placement logic. Tagged workers will not be used for any
untagged <a href="https://concourse-ci.org/steps.html">Steps</a>.</p>
<p>To run build steps on a tagged worker, specify the <a href="https://concourse-ci.org/tags-step.html#schema.tags"><code>tags</code></a> on any
particular step in your <a href="https://concourse-ci.org/jobs.html">job</a>.</p>
<p>To perform resource <code>check</code>s on a tagged worker, specify <a href="https://concourse-ci.org/resources.html#schema.resource.tags">
<code>tags</code></a> on the resource declaration.</p>
<h3 id="team-workers">Team Workers</h3>
<p>If you want to isolate <a href="https://concourse-ci.org/global-resources.html#complications-with-reusing-containers">**all workloads
**</a> for
a <a href="https://concourse-ci.org/managing-teams.html">team</a> then you can configure a worker to belong to a single team like
so:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">CONCOURSE_TEAM</span><span class="o">=</span><span class="s2">&quot;lightweavers&quot;</span>
</span></code></pre></div>
<p>Once an untagged team worker is registered Concourse will schedule all untagged builds for that team on its team worker(
s). Builds for this team will no longer be scheduled on any untagged, non-team workers.</p>
<p>It is possible to have a Concourse cluster made up of only team workers and have zero non-team workers, though this is
not a common setup because resource utilization across all workers ends up underutilized. It is useful though if you
have a particular team with heavy workloads that usually bothers other teams pipelines.</p>
<h4 id="tags-and-team-workers">Tags and Team Workers</h4>
<p>When you have a worker configured with tag(s) and a team like so:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nv">CONCOURSE_TAG</span><span class="o">=</span><span class="s2">&quot;tag-1,tag-2&quot;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nv">CONCOURSE_TEAM</span><span class="o">=</span><span class="s2">&quot;lightweavers&quot;</span>
</span></code></pre></div>
<p>Only steps that are tagged and from the specified team will be scheduled on such a worker. Any untagged work the team
has will land on either:</p>
<ol>
<li>Untagged team workers belonging to the team, or</li>
<li>Untagged workers not configured to a specific team</li>
</ol>
<h3 id="healthcheck-endpoint">Healthcheck Endpoint</h3>
<p>The worker will automatically listen on port <code>8888</code> as its healthcheck endpoint. It will return a <code>HTTP 200</code> status code
with an empty body on a successful check. A successful check means the worker can reach
the <a href="https://concourse-ci.org/internals.html#architecture-worker">Garden and BaggageClaim servers</a>.</p>
<p>The healthcheck endpoint is configurable through three variables:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>concourse<span class="w"> </span>worker<span class="w"> </span>--healthcheck-bind-ip<span class="o">=</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># IP address on which to listen for health checking requests. (default: 0.0.0.0)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>concourse<span class="w"> </span>worker<span class="w"> </span>--healthcheck-bind-port
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Port on which to listen for health checking requests. (default: 8888)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>concourse<span class="w"> </span>worker<span class="w"> </span>--healthcheck-timeout
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># HTTP timeout for the full duration of health checking. (default: 5s)</span>
</span></code></pre></div>
<h3 id="resource-types">Resource Types</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following section only applies to Linux workers. Resource types are simply Linux container images and therefore 
can't be run on Windows or Darwin workers.</p>
</div>
<h4 id="bundled-resource-types">Bundled Resource Types</h4>
<p>Workers come prepackaged with a bundle of resource types. They are included in the tarball from
the <a href="https://github.com/concourse/concourse/releases">GitHub release page</a> and are part of
the <a href="https://hub.docker.com/r/concourse/concourse">concourse/concourse image</a>.</p>
<p>To view the resource types available on a worker run:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>fly<span class="w"> </span>workers<span class="w"> </span>--details
</span></code></pre></div>
<p>If you want more details, like the version number of each resource, you can run:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>fly<span class="w"> </span>curl<span class="w"> </span>api/v1/workers
</span></code></pre></div>
<h4 id="installing-or-upgrading-bundled-resource-types">Installing or Upgrading Bundled Resource Types</h4>
<p>You may want to upgrade the bundled resource types outside of Concourse upgrades or even install additional resource
types on your workers to reduce the polling on some external image repository
like <a href="https://hub.docker.com/">Docker Hub</a>.</p>
<p>We will use the <a href="https://github.com/concourse/git-resource">git resource</a> as our example. We will assume your Concourse
installation is at <code>/usr/local/concourse</code>.</p>
<p>First, pull and create a container of the resource you're installing/upgrading. Grab the ID of the container that Docker
creates.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>concourse/git-resource
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>b253417142565cd5eb43902e94a2cf355d5354b583fbc686488c9a153584c6ba
</span></code></pre></div>
<p>Export the containers file system into a gzip compressed tar archive named <code>rootfs.tgz</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>docker<span class="w"> </span><span class="nb">export</span><span class="w"> </span>b253417142<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>rootfs.tgz
</span></code></pre></div>
<p>Create a file called <code>resource_metadata.json</code> and populate it with the following contents. Make sure the <code>type</code> does not
conflict with an existing resource type when you're installing a new resource type. In our example here we're calling
the type <code>gitv2</code> to avoid conflicting with the pre-existing <code>git</code> resource.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gitv2&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.13.0&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&quot;privileged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nt">&quot;unique_version_history&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>At this point you should have two files: <code>rootfs.tgz</code> and <code>resource_metadata.json</code>.</p>
<p>Create a new directory under the <code>resource-types</code> folder in your Concourse installation directory. By convention, it
should be the same name as the <code>type</code>.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>mkdir<span class="w"> </span>/usr/local/concourse/resource-types/gitv2
</span></code></pre></div>
<p>Place the <code>rootfs.tgz</code> and <code>resource_metadata.json</code> inside the
folder. <a href="./#restarting-a-worker">Restart your worker</a> and verify the new resource type is on there by
running one of the following commands:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>fly<span class="w"> </span>workers<span class="w"> </span>--details
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1"># or</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>fly<span class="w"> </span>curl<span class="w"> </span>api/v1/workers
</span></code></pre></div>
<p>You can also verify that Concourse can create a container with the <code>rootfs.tgz</code> you made by running a simple pipeline:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some-resource</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitv2</span><span class="w"> </span><span class="c1">#change to your resource type</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/concourse/git-resource.git</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-job</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="nt">plan</span><span class="p">:</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">get</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">some-resource</span>
</span></code></pre></div>
<h3 id="configuring-runtimes">Configuring Runtimes</h3>
<p>The worker can be run with multiple container
runtimes - <a href="https://github.com/containerd/containerd/">containerd</a>, <a href="https://github.com/cloudfoundry/guardian">Guardian</a>,
and <a href="https://github.com/vito/houdini">Houdini</a> (an experimental and the only runtime for Darwin and Windows). Only
<code>containerd</code> and <code>Guardian</code> are meant for production use. <code>Guardian</code> is the default runtime for Concourse.</p>
<div class="admonition note">
<p class="admonition-title">Note about Architecture</p>
<p>The web node (ATC) talks to all 3 runtimes via a single interface called the 
<a href="https://github.com/cloudfoundry/garden">Garden</a> server. While Guardian comes packaged with a Garden server and 
its flags in Concourse are unfortunately prefixed with <code>--garden-*</code>, Guardian (a runtime) and Garden 
(an interface and server) are two separate tools. An analogy for Garden would be the <a href="https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/">Container Runtime 
Interface (CRI)</a> used in 
Kubernetes. Kubernetes uses containerd via CRI. Concourse uses containerd via Garden.</p>
</div>
<h4 id="containerd-runtime"><code>containerd</code> runtime</h4>
<p>To use the <code>containerd</code> runtime manually set the <code>--runtime</code> (<code>CONCOURSE_RUNTIME</code>) to <code>containerd</code> on the
<code>concourse worker</code> command.</p>
<p>The following is a list of the <code>containerd</code> runtime specific flags for Concourse that can be set. They are all optional
and have default values.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Containerd Configuration:
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>  --containerd-config=                               Path to a config file to use for the Containerd daemon. [$CONCOURSE_CONTAINERD_CONFIG]
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  --containerd-bin=                                  Path to a containerd executable (non-absolute names get resolved from $PATH). [$CONCOURSE_CONTAINERD_BIN]
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  --containerd-init-bin=                             Path to an init executable (non-absolute names get resolved from $PATH). (default: /usr/local/concourse/bin/init) [$CONCOURSE_CONTAINERD_INIT_BIN]
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>  --containerd-cni-plugins-dir=                      Path to CNI network plugins. (default: /usr/local/concourse/bin) [$CONCOURSE_CONTAINERD_CNI_PLUGINS_DIR]
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>  --containerd-request-timeout=                      How long to wait for requests to Containerd to complete. 0 means no timeout. (default: 5m) [$CONCOURSE_CONTAINERD_REQUEST_TIMEOUT]
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>  --containerd-max-containers=                       Max container capacity. 0 means no limit. (default: 250) [$CONCOURSE_CONTAINERD_MAX_CONTAINERS]
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>  --containerd-privileged-mode=                      How many privileges privileged containers get. full is equivalent to root on host. ignore means no extra privileges. fuse-only means enough to use fuse-overlayfs. (default: full) [$CONCOURSE_CONTAINERD_PRIVILEGED_MODE]
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>Containerd Container Networking:
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>  --containerd-external-ip=                          IP address to use to reach container&#39;s mapped ports. Autodetected if not specified. [$CONCOURSE_CONTAINERD_EXTERNAL_IP]
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>  --containerd-dns-server=                           DNS server IP address to use instead of automatically determined servers. Can be specified multiple times. [$CONCOURSE_CONTAINERD_DNS_SERVER]
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>  --containerd-restricted-network=                   Network ranges to which traffic from containers will be restricted. Can be specified multiple times. [$CONCOURSE_CONTAINERD_RESTRICTED_NETWORK]
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>  --containerd-additional-hosts=                     Additional entries to add to /etc/hosts in containers. [$CONCOURSE_CONTAINERD_ADDITIONAL_HOSTS]
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>  --containerd-network-pool=                         Network range to use for dynamically allocated container subnets. (default: 10.80.0.0/16) [$CONCOURSE_CONTAINERD_NETWORK_POOL]
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>  --containerd-mtu=                                  MTU size for container network interfaces. Defaults to the MTU of the interface used for outbound access by the host. [$CONCOURSE_CONTAINERD_MTU]
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>  --containerd-allow-host-access                     Allow containers to reach the host&#39;s network. This is turned off by default. [$CONCOURSE_CONTAINERD_ALLOW_HOST_ACCESS]
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>DNS Proxy Configuration:
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>  --containerd-dns-proxy-enable                      Enable proxy DNS server. Note: this will enable containers to access the host network. [$CONCOURSE_CONTAINERD_DNS_PROXY_ENABLE]
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to read <a href="./#a-note-on-allowing-host-access-and-dns-proxy">A note on allowing host access</a> 
and DNS proxy to understand the implications of using <code>--containerd-allow-host-access</code> and 
<code>--containerd-dns-proxy-enable</code></p>
</div>
<h4 id="transitioning-from-guardian-to-containerd">Transitioning from Guardian to containerd</h4>
<p>If you are transitioning from <code>Guardian</code> to <code>containerd</code> you will need to convert any <code>--garden-*</code> (
<code>CONCOURSE_GARDEN_*</code>) flags to their <code>containerd</code> (<code>CONCOURSE_CONTAINERD_*</code>) counterparts:</p>
<table>
<thead>
<tr>
<th>Guardian Flags</th>
<th>Containerd Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--garden-request-timeout</code><br/><code>CONCOURSE_GARDEN_REQUEST_TIMEOUT</code></td>
<td><code>--containerd-request-timeout</code><br/><code>CONCOURSE_CONTAINERD_REQUEST_TIMEOUT</code></td>
</tr>
<tr>
<td><code>--garden-dns-proxy-enable</code><br/><code>CONCOURSE_GARDEN_DNS_PROXY_ENABLE</code></td>
<td>-<code>-containerd-dns-proxy-enable</code><br/><code>CONCOURSE_CONTAINERD_DNS_PROXY_ENABLE</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag</em><br/><code>CONCOURSE_GARDEN_ALLOW_HOST_ACCESS</code></td>
<td><code>--containerd-allow-host-access</code><br/><code>CONCOURSE_CONTAINERD_ALLOW_HOST_ACCESS</code></td>
</tr>
<tr>
<td><code>--garden-network-pool</code><br/><code>CONCOURSE_GARDEN_NETWORK_POOL</code></td>
<td><code>--containerd-network-pool</code><br/><code>CONCOURSE_CONTAINERD_NETWORK_POOL</code></td>
</tr>
<tr>
<td><code>--garden-max-containers</code><br/><code>CONCOURSE_GARDEN_MAX_CONTAINERS</code></td>
<td><code>--containerd-max-containers</code><br/><code>CONCOURSE_CONTAINERD_MAX_CONTAINERS</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag</em><br/><code>CONCOURSE_GARDEN_DENY_NETWORKS</code></td>
<td><code>--containerd-restricted-network</code><br/><code>CONCOURSE_CONTAINERD_RESTRICTED_NETWORK</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag or ENV option.<br/>Configured through</em> <code>garden_config.ini</code></td>
<td><code>--containerd-additional-hosts</code><br/><code>CONCOURSE_CONTAINERD_ADDITIONAL_HOSTS</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag</em><br/><code>CONCOURSE_GARDEN_DNS_SERVER</code></td>
<td><code>--containerd-dns-server</code><br/><code>CONCOURSE_CONTAINERD_DNS_SERVER</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag</em><br/><code>CONCOURSE_GARDEN_EXTERNAL_IP</code></td>
<td><code>--containerd-external-ip</code><br/><code>CONCOURSE_CONTAINERD_EXTERNAL_IP</code></td>
</tr>
<tr>
<td><em>No equivalent CLI flag</em><br/><code>CONCOURSE_GARDEN_MTU</code></td>
<td><code>--containerd-mtu</code><br/><code>CONCOURSE_CONTAINERD_MTU</code></td>
</tr>
</tbody>
</table>
<h4 id="guardian-runtime"><code>Guardian</code> runtime</h4>
<p>Guardian is currently the default runtime for Concourse. It can also be set by setting the <code>--runtime</code> flag to
<code>guardian</code> on the <code>concourse worker</code> command.</p>
<p>The <code>concourse worker</code> command automatically configures and runs <code>Guardian</code> using the <code>gdn</code> binary, but depending on the
environment you're running Concourse in, you may need to pop open the hood and configure a few things.</p>
<p>The <code>gdn</code> server can be configured in two ways:</p>
<ol>
<li>
<p>By creating a <code>config.ini</code> file and passing it as <code>--garden-config</code> (or <code>CONCOURSE_GARDEN_CONFIG</code>). The .ini file
   should look something like this:
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">[server]</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="na">flag-name</span><span class="o">=</span><span class="s">flag-value</span><span class="w"> </span>
</span></code></pre></div>
   To learn which flags can be set, consult <code>gdn server --help</code>. Each flag listed can be set under the <code>[server]</code>
   heading.</p>
</li>
<li>
<p>By setting <code>CONCOURSE_GARDEN_*</code> environment variables. This is primarily supported for backwards compatibility, and
   these variables are not present in <code>concourse worker --help</code>. They are translated to flags passed to <code>gdn server</code> by
   lower-casing the <code>*</code> portion and replacing underscores with hyphens.</p>
</li>
</ol>
<h4 id="troubleshooting-and-fixing-dns-resolution">Troubleshooting and fixing DNS resolution</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Guardian runtime took care of a lot of container creation operations for Concourse in the past. It was very 
user-friendly for the project to use as a container runtime. While implementing the containerd runtime most 
reported bugs were actually a difference in containerd's default behaviour compared to Guardian's. Currently 
Concourse's containerd runtime mostly behaves like the Guardian runtime did. Most of the following DNS section 
should apply to both runtimes.</p>
</div>
<p>By default, containers created by the Guardian or containerd (will refer to both as <em>runtime</em>) runtime will carry over
the <code>/etc/resolv.conf</code> from the host into the container. This is often fine, but some Linux distributions configure a
special <code>127.x.x.x</code> DNS resolver (e.g. <code>systemd-resolved</code>).</p>
<p>When the runtime copies the <code>resolv.conf</code> over, it removes these entries as they won't be reachable from the container's
network namespace. As a result, your containers may not have any valid nameservers configured.</p>
<p>To diagnose this problem you can <a href="https://concourse-ci.org/builds.html#fly-intercept"><code>fly intercept</code></a> into a failing
container and check which nameservers are in <code>/etc/resolv.conf</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$<span class="w"> </span>fly<span class="w"> </span>-t<span class="w"> </span>ci<span class="w"> </span>intercept<span class="w"> </span>-j<span class="w"> </span>concourse/concourse
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>bash-5.0$<span class="w"> </span>grep<span class="w"> </span>nameserver<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>bash-5.0$
</span></code></pre></div>
<p>In this case it is empty, as the host only listed a single <code>127.0.0.53</code> address which was then stripped out. To fix this
you'll need to explicitly configure DNS instead of relying on the default runtime behavior.</p>
<h5 id="pointing-to-external-dns-servers">Pointing to external DNS servers</h5>
<p>If you have no need for special DNS resolution within your Concourse containers, you can configure your containers to
use specific DNS server addresses external to the VM.</p>
<p>The Guardian and containerd runtimes can have their DNS servers configured with flags or envs vars.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="dns-via-flags-containerd" name="__tabbed_1" type="radio" /><input id="dns-via-env-vars" name="__tabbed_1" type="radio" /><input id="configini-guardian" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="dns-via-flags-containerd">DNS via flags (containerd)</label><label for="dns-via-env-vars">DNS via env vars</label><label for="configini-guardian"><code>config.ini</code> (Guardian)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>concourse<span class="w"> </span>worker<span class="w"> </span>--containerd-dns-server<span class="o">=</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="w"> </span>--containerd-dns-server<span class="o">=</span><span class="s2">&quot;8.8.8.8&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># containerd runtime</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nv">CONCOURSE_CONTAINERD_DNS_SERVER</span><span class="o">=</span><span class="s2">&quot;1.1.1.1,8.8.8.8&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c1"># Guardian runtime</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nv">CONCOURSE_GARDEN_DNS_SERVER</span><span class="o">=</span><span class="s2">&quot;1.1.1.1,8.8.8.8&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">[server]</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1">; configure Google DNS</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="na">dns-server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8.8.8.8</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="na">dns-server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8.8.4.4</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>To verify this solves your problem you can <a href="https://concourse-ci.org/builds.html#fly-intercept"><code>fly intercept</code></a> into a
container and check which nameservers are in <code>/etc/resolv.conf</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>$<span class="w"> </span>fly<span class="w"> </span>-t<span class="w"> </span>ci<span class="w"> </span>intercept<span class="w"> </span>-j<span class="w"> </span>my-pipeline/the-job
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>bash-5.0$<span class="w"> </span>cat<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>nameserver<span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>nameserver<span class="w"> </span><span class="m">8</span>.8.8.8
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>bash-5.0$<span class="w"> </span>ping<span class="w"> </span>google.com
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>PING<span class="w"> </span>google.com<span class="w"> </span><span class="o">(</span><span class="m">108</span>.177.111.139<span class="o">)</span>:<span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">108</span>.177.111.139:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">47</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">2</span>.672<span class="w"> </span>ms
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">108</span>.177.111.139:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">47</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.911<span class="w"> </span>ms
</span></code></pre></div>
<h5 id="using-a-local-dns-server">Using a local DNS server</h5>
<p>If you would like to use Consul, <code>dnsmasq</code>, or some other DNS server running on the worker VM, you'll have to configure
the LAN address of the VM as the DNS server and allow the containers to reach the address, like so:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="local-dns-via-flags-containerd" name="__tabbed_2" type="radio" /><input id="local-dns-via-env-vars" name="__tabbed_2" type="radio" /><input id="configini-guardian_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="local-dns-via-flags-containerd">Local DNS via flags (containerd)</label><label for="local-dns-via-env-vars">Local DNS via env vars</label><label for="configini-guardian_1"><code>config.ini</code> (Guardian)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>concourse<span class="w"> </span>worker<span class="w"> </span>--containerd-dns-server<span class="o">=</span><span class="s2">&quot;10.0.1.3&quot;</span><span class="w"> </span>--containerd-allow-host-access<span class="o">=</span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># containerd runtime</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nv">CONCOURSE_CONTAINERD_DNS_SERVER</span><span class="o">=</span><span class="s2">&quot;10.0.1.3&quot;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nv">CONCOURSE_CONTAINERD_ALLOW_HOST_ACCESS</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># Guardian runtime</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nv">CONCOURSE_GARDEN_DNS_SERVER</span><span class="o">=</span><span class="s2">&quot;10.0.1.3&quot;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nv">CONCOURSE_GARDEN_ALLOW_HOST_ACCESS</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">[server]</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1">; internal IP of the worker machine</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="na">dns-server</span><span class="o">=</span><span class="s">10.0.1.3</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="c1">; allow containers to reach the above IP</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="na">allow-host-access</span><span class="o">=</span><span class="s">true</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to read <a href="./#a-note-on-allowing-host-access-and-dns-proxy">A note on allowing host access</a> 
and DNS proxy to understand the implications of using <code>allow-host-access</code></p>
</div>
<p>To validate whether the changes have taken effect, you can <a href="https://concourse-ci.org/builds.html#fly-intercept">
<code>fly intercept</code></a> into any container and check <code>/etc/resolv.conf</code>
once again:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>$<span class="w"> </span>fly<span class="w"> </span>-t<span class="w"> </span>ci<span class="w"> </span>intercept<span class="w"> </span>-j<span class="w"> </span>my-pipeline/the-job
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>bash-5.0$<span class="w"> </span>cat<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>nameserver<span class="w"> </span><span class="m">10</span>.1.2.3
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>bash-5.0$<span class="w"> </span>nslookup<span class="w"> </span>concourse-ci.org
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>Server:<span class="w">         </span><span class="m">10</span>.1.2.3
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>Address:<span class="w">        </span><span class="m">10</span>.1.2.3#53
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>Non-authoritative<span class="w"> </span>answer:
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>Name:<span class="w">   </span>concourse-ci.org
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>Address:<span class="w"> </span><span class="m">185</span>.199.108.153
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>Name:<span class="w">   </span>concourse-ci.org
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>Address:<span class="w"> </span><span class="m">185</span>.199.109.153
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>Name:<span class="w">   </span>concourse-ci.org
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>Address:<span class="w"> </span><span class="m">185</span>.199.110.153
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>Name:<span class="w">   </span>concourse-ci.org
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>Address:<span class="w"> </span><span class="m">185</span>.199.111.153
</span></code></pre></div>
<p>If <code>nslookup</code> times out or fails, you may need to open up firewalls or security group configuration so that the worker
VM can send UDP/TCP packets to itself.</p>
<h5 id="a-note-on-allowing-host-access-and-dns-proxy">A note on allowing host access and DNS proxy</h5>
<p>Setting <code>allow-host-access</code> will, well, allow containers to access your host VM's network. If you don't trust your
container workloads, you may not want to allow this. With host network access, containers will be able to reach out to
any other locally running network processes running on the worker including the garden and baggageclaim servers <strong>which
would allow them to issue commands and manipulate other containers and volumes on the same worker</strong>.</p>
<p>Setting <code>dns-proxy-enable</code> will also enable <code>allow-host-access</code> (since the dns proxy will be run on the host, therefore
requiring host access be enabled).</p>
<h3 id="configuring-peer-to-peer-volume-streaming">Configuring Peer-to-Peer Volume Streaming</h3>
<p>Peer-to-Peer (P2P) volume streaming enables the workers to stream volumes directly to each other instead of always
streaming volumes through the web node(s). This can reduce the time it takes for individual steps in a job to start and
reduce the amount of network traffic used by the Concourse cluster.</p>
<div class="admonition warning">
<p class="admonition-title">Experimental Feature</p>
<p>This feature is experimental. It is not as robust as the default volume streaming setup which always goes 
through web nodes.</p>
</div>
<p><strong>Pre-Requisites</strong></p>
<ul>
<li>All worker nodes need to be able to reach each other via IP address. This usually means they are on the same LAN. You
  can test this by trying to ping one worker from another worker. If even one worker does not meet this requirement then
  you cannot use P2P volume streaming.</li>
<li>The baggageclaim port (<code>7788</code> is the default) is open to traffic on all worker nodes. You can verify the port is open
  and reaching the baggageclaim API server by hitting the <code>/volumes</code> endpoint.
  <br/>
  <div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>curl<span class="w"> </span>http://&lt;worker-IP-address&gt;:7788/volumes
</span></code></pre></div></li>
</ul>
<p>To enable P2P volume streaming you need to configure some settings on the web and worker nodes. Configure the worker
nodes first. Configure the web node(s) last.</p>
<h4 id="p2p-worker-configuration">P2P Worker Configuration</h4>
<ul>
<li><code>CONCOURSE_BAGGAGECLAIM_BIND_IP=0.0.0.0</code> - <em>Required</em>. The worker needs to listen for traffic over <code>127.0.0.1</code> (to
  receive info from the web node) as well as its LAN IP in a P2P setup. Therefore, we need to set the IP baggageclaim
  binds to <code>0.0.0.0</code>.</li>
<li><code>CONCOURSE_BAGGAGECLAIM_P2P_INTERFACE_NAME_PATTERN=eth0</code> - <em>Optional</em>. Regular expression to match a network interface
  for P2P streaming. This is how a worker determines its own LAN IP address, by looking it up via the LAN interface
  specified by this flag.
  <br/>
  <br/>
  You can determine the name of the LAN interface for any worker by listing all network interfaces and noting which
  interface has the LAN IP that you want the worker to use.
  <br/>
  <br/>
  To view all available network interfaces on your worker:<ul>
<li>On Linux run <code>ip addr list</code></li>
<li>On MacOS run <code>ifconfig</code></li>
<li>On Windows run <code>ipconfig</code>. Windows network interface names are very different from Unix device names. Example
  network interface names for Windows include:
  <br/>
  <div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>Ethernet 4
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>Local Area Connection* 2
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Local Area Connection* 12
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>Wi-Fi 5
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>Bluetooth Network Connection 2
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>Loopback Pseudo-Interface 1
</span></code></pre></div></li>
</ul>
</li>
<li><code>CONCOURSE_BAGGAGECLAIM_P2P_INTERFACE_FAMILY=4</code> - <em>Optional</em>. Tells the worker to use IPv4 or IPv6. Defaults to <code>4</code>
  for IPv4. Set to <code>6</code> for IPv6.</li>
</ul>
<h4 id="p2p-web-configuration">P2P Web Configuration</h4>
<p>You need to tell the web node(s) to use P2P volume streaming.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nv">CONCOURSE_ENABLE_P2P_VOLUME_STREAMING</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<p>Once that flag is set and the web node is restarted, P2P volume streaming will start occurring in your Concourse
cluster.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../running-web/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Running a web node">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Running a web node
              </div>
            </div>
          </a>
        
        
          
          <a href="../upgrading-concourse/" class="md-footer__link md-footer__link--next" aria-label="Next: Upgrading Concourse">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Upgrading Concourse
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.prune", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "content.code.copy", "attr_list", "md_in_html", "pymdownx.blocks.caption", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>